# Makefile –¥–ª—è AI Daily Tasks

.PHONY: help build up down logs restart status clean backup

# Default target
help:
	@echo "ü§ñ AI Daily Tasks - Docker —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ"
	@echo "======================================"
	@echo ""
	@echo "–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:"
	@echo "  make build    - –°–±–æ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–∞"
	@echo "  make up       - –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã"
	@echo "  make down     - –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º—ã"
	@echo "  make restart  - –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã"
	@echo "  make logs     - –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤"
	@echo "  make status   - –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞"
	@echo "  make clean    - –û—á–∏—Å—Ç–∫–∞ (—É–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏ –æ–±—Ä–∞–∑–∞)"
	@echo "  make backup   - –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö"
	@echo ""
	@echo "üåê –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ:"
	@echo "  –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å: http://localhost:8501"
	@echo "  API: http://localhost:8000"

# –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
build:
	@echo "üî® –°–±–æ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–∞..."
	docker-compose build

# –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã
up:
	@echo "üöÄ –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã..."
	docker-compose up -d
	@echo "‚úÖ –°–∏—Å—Ç–µ–º–∞ –∑–∞–ø—É—â–µ–Ω–∞!"
	@echo "üåê –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å: http://localhost:8501"
	@echo "üåê API: http://localhost:8000"

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º—ã
down:
	@echo "‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º—ã..."
	docker-compose down
	@echo "‚úÖ –°–∏—Å—Ç–µ–º–∞ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞"

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã
restart:
	@echo "üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã..."
	docker-compose restart
	@echo "‚úÖ –°–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω–∞"

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
logs:
	@echo "üìã –õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã (Ctrl+C –¥–ª—è –≤—ã—Ö–æ–¥–∞):"
	docker-compose logs -f

# –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
status:
	@echo "üìä –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:"
	docker-compose ps
	@echo ""
	@echo "üìà –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤:"
	docker stats ai-daily-tasks --no-stream || echo "–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω"

# –û—á–∏—Å—Ç–∫–∞
clean:
	@echo "üßπ –û—á–∏—Å—Ç–∫–∞ Docker —Ä–µ—Å—É—Ä—Å–æ–≤..."
	docker-compose down
	docker-compose rm -f
	docker rmi ai-daily-tasks_ai-daily-tasks 2>/dev/null || echo "–û–±—Ä–∞–∑ —É–∂–µ —É–¥–∞–ª–µ–Ω"
	@echo "‚úÖ –û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"

# –ë—ç–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
backup:
	@echo "üíæ –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö..."
	@if [ -f "./data/reports_backup.sqlite" ]; then \
		cp ./data/reports_backup.sqlite ./backup_$$(date +%Y%m%d_%H%M%S).sqlite && \
		echo "‚úÖ –ë—ç–∫–∞–ø —Å–æ–∑–¥–∞–Ω: backup_$$(date +%Y%m%d_%H%M%S).sqlite"; \
	else \
		echo "‚ùå –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"; \
	fi

# –ü–æ–ª–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ (—Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π .env)
install:
	@echo "üì¶ –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞..."
	@if [ ! -f ".env" ]; then \
		cp docker.env.example .env && \
		echo "‚úÖ –§–∞–π–ª .env —Å–æ–∑–¥–∞–Ω –∏–∑ –ø—Ä–∏–º–µ—Ä–∞"; \
		echo "‚ö†Ô∏è  –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª –∏ —É–∫–∞–∂–∏—Ç–µ —Å–≤–æ–∏ API –∫–ª—é—á–∏!"; \
	else \
		echo "‚úÖ –§–∞–π–ª .env —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"; \
	fi
	@mkdir -p ./data
	@echo "‚úÖ –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–Ω–∞"
	@echo "üìù –¢–µ–ø–µ—Ä—å –∑–∞–ø—É—Å—Ç–∏—Ç–µ: make up" 